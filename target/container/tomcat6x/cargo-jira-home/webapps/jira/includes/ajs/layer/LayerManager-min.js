(function(){JIRA.bind("Dialog.beforeHide",function(e){if(typeof Calendar!=="undefined"&&Calendar.current){e.preventDefault()}if(JIRA.Dropdown&&JIRA.Dropdown.current){e.preventDefault()}if(AJS.InlineLayer&&AJS.InlineLayer.current){e.preventDefault()}if(AJS.Dropdown&&AJS.Dropdown.current){e.preventDefault()}if(AJS.InlineDialog&&AJS.InlineDialog.current){e.preventDefault()}});var $doc=jQuery(document);function getWindow(){var topWindow=window;try{while(topWindow.parent.window!==topWindow.window&&topWindow.parent.AJS){topWindow=topWindow.parent}}catch(error){}return topWindow}function getLayer(instance){return(instance.$layer||instance.$popup||instance.$||instance.popup||instance)[0]}function listenForLayerEvents($doc){$doc.bind("showLayer",function(e,type,item){if(item&&item.id&&(item.id.indexOf("user-hover-dialog")>=0||item.id.indexOf("aui-inline-edit-error")>=0||item.id.indexOf("share-entity-popup")>=0)){return }var topWindow=getWindow().AJS;if(topWindow.currentLayerItem&&item!==topWindow.currentLayerItem&&topWindow.currentLayerItem.type!=="popup"){topWindow.currentLayerItem.hide()}if(item){topWindow.currentLayerItem=item;topWindow.currentLayerItem.type=type}}).bind("hideLayer",function(e,type,item){if(!item||item.id&&(item.id.indexOf("user-hover-dialog")>=0||item.id.indexOf("aui-inline-edit-error")>=0)){return }var topWindow=getWindow().AJS;if(topWindow.currentLayerItem){if(topWindow.currentLayerItem===item){topWindow.currentLayerItem=null}else{if(jQuery.contains(getLayer(item),getLayer(topWindow.currentLayerItem))){topWindow.currentLayerItem.hide()}}}}).bind("hideAllLayers",function(){var topWindow=getWindow().AJS;if(topWindow.currentLayerItem){topWindow.currentLayerItem.hide()}}).click(function(e){var topWindow=getWindow().AJS;if(topWindow.currentLayerItem&&topWindow.currentLayerItem.type!=="popup"){if(topWindow.currentLayerItem._validateClickToClose){if(topWindow.currentLayerItem._validateClickToClose(e)){topWindow.currentLayerItem.hide()}}else{topWindow.currentLayerItem.hide()}}})}$doc.bind("iframeAppended",function(e,iframe){iframe=jQuery(iframe);iframe.load(function(){listenForLayerEvents(iframe.contents())})});listenForLayerEvents($doc)})();