jQuery.fn.stalker=function(){var $win=jQuery(window),$doc=jQuery(document),$stalkerContent,$stalker,$transitionElems,offsetY,placeholder,lastScrollPosY,stalkerHeight,isInitialized,selector=this.selector;function getScrollTop(scrollPos){return Math.max(0,jQuery(window).scrollTop(scrollPos))}function isSupported(){if(jQuery.browser.msie&&jQuery.browser.version<7){return false}return true}function supportsOpacityTransition(){return !jQuery.browser.msie||(jQuery.browser.msie&&jQuery.browser.version>8)}function getInactiveProperties(){return{position:"fixed",top:offsetY-getScrollTop()}}function initialize(){$stalker=jQuery(selector);if($stalker.length===0){return }offsetY=$stalker.offset().top;$stalkerContent=$stalker.find(".stalker-content");$transitionElems=AJS.$("#header");function setStalkerHeight(){$stalker.css("overflow","hidden");stalkerHeight=$stalker.outerHeight();$stalker.css("overflow","")}function createPlaceholder(){placeholder=jQuery("<div />").addClass("stalker-placeholder").css({visibility:"hidden",height:stalkerHeight}).insertBefore($stalker)}function setPlaceholderHeight(){placeholder.height($stalkerContent.outerHeight())}setStalkerHeight();createPlaceholder();setPlaceholderHeight();$stalker.css(getInactiveProperties());$stalker.bind("stalkerHeightUpdated",setPlaceholderHeight);$stalker.bind("positionChanged",setStalkerPosition);isInitialized=true}function offsetPageScrolling(){function setScrollPostion(scrollTarget){var docHeight=jQuery.getDocHeight(),scrollPos;if(scrollTarget>=0&&scrollTarget<=docHeight){scrollPos=scrollTarget}else{if(scrollTarget>=getScrollTop()){scrollPos=docHeight}else{if(scrollTarget<0){scrollPos=0}}}getScrollTop(scrollPos)}function pageUp(){if(!isInitialized){initialize()}var scrollTarget=getScrollTop()-jQuery(window).height();setScrollPostion(scrollTarget+stalkerHeight)}function pageDown(){if(!isInitialized){initialize()}var scrollTarget=getScrollTop()+jQuery(window).height();setScrollPostion(scrollTarget-stalkerHeight)}$doc.bind("keydown",function(event){if(jQuery(event.target).is("input,select,textarea,button")){return }var handler;switch(event.keyCode){case AJS.$.ui.keyCode.SPACE:handler=(event.shiftKey)?pageUp:pageDown;break;case AJS.$.ui.keyCode.PAGE_UP:handler=pageUp;break;case AJS.$.ui.keyCode.PAGE_DOWN:handler=pageDown;break;default:return }if(jQuery("body").css("overflow")!=="hidden"){handler()}event.preventDefault()})}function containDropdownsInWindow(){$doc.bind("showLayer",function(e,type,obj){var stalkerOffset,targetHeight;if(!isInitialized){initialize()}if(type==="dropdown"&&obj.$.parents(selector).length!==-1){stalkerOffset=($stalker.hasClass("detached")||!$stalker.offset()?0:$stalker.offset().top);targetHeight=jQuery(window).height()-$stalker.height()-stalkerOffset;if(targetHeight<=parseInt(obj.$.attr("scrollHeight"),10)){JIRA.containDropdown.containHeight(obj,targetHeight)}else{JIRA.containDropdown.releaseContainment(obj)}obj.reset()}})}if(!isSupported()){return }if(jQuery.browser.msie){jQuery(setup);jQuery(setStalkerPosition)}else{setup()}function setup(){offsetPageScrolling();containDropdownsInWindow();$doc.click(function(e){if(jQuery(e.target).parents(selector).length!==0&&!isInitialized){initialize()}});$doc.bind("showLayer",function(e,type,obj){if(obj&&$transitionElems&&supportsOpacityTransition()){var $offsetTarget=obj.$offsetTarget||obj.trigger;if($offsetTarget&&$offsetTarget[0]){for(var i=0;i<$transitionElems.length;i++){if($transitionElems[i]===$offsetTarget[0]||jQuery.contains($transitionElems[i],$offsetTarget[0])){$transitionElems.css("opacity","");break}}}else{if(obj.id==="create_issue_popup"){$transitionElems.css("opacity","")}}}if(jQuery.browser.mozilla&&type==="popup"){setStalkerPosition()}});$win.scroll(setStalkerPosition);$win.resize(function(){if($stalker){$stalker.trigger("stalkerHeightUpdated")}})}function setStalkerPosition(){function getOpacitySetting(){var opacityTarget=1-getScrollTop()/offsetY;if(opacityTarget>1){return""}else{if(opacityTarget<0){return 0}else{return opacityTarget}}}if(!isInitialized){initialize()}if(supportsOpacityTransition()&&$transitionElems){$transitionElems.css("opacity",getOpacitySetting())}if(offsetY<=getScrollTop()){if(!$stalker.hasClass("detached")){$stalker.css({top:0,position:"fixed"}).addClass("detached")}}else{$stalker.css(getInactiveProperties()).removeClass("detached")}lastScrollPosY=getScrollTop()}return this};