(function(){var eventsToListenTo="input keyup";jQuery.fn.expandOnInput=function(maxHeight){var $textareas=this.filter("textarea");$textareas.unbind(eventsToListenTo,setHeight).bind(eventsToListenTo,setHeight);if(AJS.$.browser.mozilla||AJS.$.browser.msie){$textareas.unbind("paste",triggerKeyup).bind("paste",triggerKeyup)}$textareas.unbind("refreshInputHeight").bind("refreshInputHeight",function(){setHeight.call(AJS.$(this).css("height",""))});$textareas.data("expandOnInput_maxHeight",maxHeight);$textareas.each(function(){var $this=AJS.$(this);$this.each(function(){var $this=AJS.$(this);$this.data("hasFixedParent",!!$this.hasFixedParent())});if(AJS.$(this).val()!==""){setHeight.call(this)}});return this};function triggerKeyup(){var $textarea=AJS.$(this),textarea=this;setTimeout(function(){$textarea.keyup();textarea.scrollTop=textarea.scrollHeight},0)}function setHeight(){var $textarea=AJS.$(this),height=$textarea.outerHeight(),padding=$textarea.attr("clientHeight")-height;this.scrollHeight;var maxHeight=parseInt($textarea.css("maxHeight"),10)||$textarea.data("expandOnInput_maxHeight")||AJS.$(window).height()-160,newHeight=Math.max(height,this.scrollHeight-padding);if(newHeight<maxHeight){$textarea.css({"overflow":"hidden","height":newHeight+"px"})}else{var cursorPosition=this.selectionStart;$textarea.css({"overflow-y":"auto","height":maxHeight+"px"});$textarea.unbind(eventsToListenTo,setHeight);$textarea.unbind("paste",triggerKeyup);if(this.selectionStart!==cursorPosition){this.selectionStart=cursorPosition;this.selectionEnd=cursorPosition}newHeight=maxHeight}if(!$textarea.data("hasFixedParent")){var $window=AJS.$(window),scrollTop=$window.scrollTop(),minScrollTop=$textarea.offset().top+newHeight-$window.height()+29;if(scrollTop<minScrollTop){$window.scrollTop(minScrollTop)}}$textarea.trigger("stalkerHeightUpdated")}})();